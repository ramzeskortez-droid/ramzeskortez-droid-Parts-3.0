# История версий проекта

## 1.9.13
- **Backend (GAS):** Реализован "Strict Leader Mode". При выборе лидера скрипт принудительно проходит по всем конкурентным офферам и сбрасывает их статус в "РЕЗЕРВ". Это решает проблему дублирования лидеров.
- **Backend (GAS):** Добавлена синхронизация правок. При редактировании заказа Админом (изменение названия детали/модели), изменения автоматически распространяются на JSON всех связанных офферов.
- **Client Interface:** Обновлена кнопка "Отказаться". Вместо системного `window.confirm` используется UI-паттерн "Двойное нажатие" (Серая -> Красная "Подтвердить?").
- **Файлы:** `archive/TG_BLOCK_V2.js`, `components/ClientInterface.tsx`.

## 1.9.12
- **Backend (GAS):** Полностью переписана логика выбора лидера (`handleRankUpdate`). Теперь при установке лидера скрипт принудительно обходит все остальные офферы и сбрасывает статус конкурентов в `РЕЗЕРВ` по этой детали. Это устраняет проблему дублирования лидеров.
- **Backend (GAS):** Добавлена логика распространения изменений (`propagateEditsToOffers`). При обновлении JSON заказа (например, Админ переименовал деталь или модель), скрипт автоматически обновляет эти поля во всех связанных офферах.
- **Client Interface:** Улучшена кнопка "Отказаться". Удален блокирующийся `window.confirm`. Реализована двухступенчатая кнопка "Отказаться" -> "Подтвердить?" с тайм-аутом сброса 3 секунды.
- **Файлы:** `archive/TG_BLOCK_V2.js`, `components/ClientInterface.tsx`.

## 1.9.11
- **Admin Interface:** Исправлен баг двойных лидеров. Теперь выбор лидера принудительно сбрасывает статус конкурентов в `РЕЗЕРВ`.
- **Admin Interface:** Исправлена фильтрация вкладок. Утвержденные заказы (`processed`) теперь автоматически попадают в "Архив", исчезая из "Новых".
- **Admin Interface:** Реализовано мгновенное локальное применение изменений при редактировании заказа (Optimistic Update), чтобы данные не "мигали" до ответа сервера.
- **Client Interface:** Добавлена кнопка обновления списка (Refresh) рядом с вкладками.
- **Client Interface:** Пофикшена кнопка "Отказаться" (добавлен `type="button"`, `stopPropagation` и убрана лишняя блокировка `disabled`).
- **Файлы:** `components/AdminInterface.tsx`, `components/ClientInterface.tsx`.

## 1.9.10
- **Admin Interface:** Список заказов - возвращен счетчик "N офферов" вместо статуса "ГОТОВО" для открытых заказов (Task 18.1).
- **Admin Interface:** Детальный вид - Лейаут кнопок действий изменен на `(Edit) (Annul) | (Approve)` (Task 18.2).
- **Admin Interface:** Офферы переведены на Grid Layout для четкого выравнивания цен и кнопок (Task 18.3).
- **Admin Interface:** Кнопка "Выбрать" теперь меняется на зеленую "ЛИДЕР" и мгновенно обновляет интерфейс без перезагрузки (Task 23).
- **Client Interface:** Исправлена кнопка "Отказаться" — добавлен `window.confirm` и разблокировка состояния (Task 19).
- **Файлы:** `components/AdminInterface.tsx`, `components/ClientInterface.tsx`.

## 1.9.9
- **Admin Interface:** Полная переработка блока деталей заказа: 7 колонок (Клиент, Телефон, VIN, Модель, Марка, Год, Кузов). Телефон теперь отображается.
- **Admin Interface:** Кнопки "Изменить заказ" и "Аннулировать" перемещены вниз (в футер), в одну линию с "Утвердить КП".
- **Admin Interface:** Исправлена критическая ошибка "Исчезающие инпуты". Поля ввода цены админа и валюты теперь всегда видны. Кнопка "Выбрать" берет значения из этих полей.
- **Admin Interface:** Исправлено сохранение изменений в режиме редактирования (проблема JSON).
- **Client Interface:** Исправлена кнопка "Отказаться" (не работала). Теперь вызывает аннулирование.
- **Client Interface:** При создании заказа теперь сохраняется номер телефона клиента.
- **Service:** Изменена сортировка — готовые (processed) заказы всегда сверху.
- **Файлы:** `AdminInterface.tsx`, `ClientInterface.tsx`, `sheetService.ts`, `types.ts`.

## 1.9.8
- **Admin Interface:** Реализован режим редактирования заказа ("ИЗМЕНИТЬ ЗАКАЗ" -> "УТВЕРДИТЬ ИЗМЕНЕНИЯ"). Админ может менять название модели и деталей. Изменения сохраняются как `AdminModel`, `AdminName`, не затирая оригинальные данные (Задача 18, 23).
- **Admin Interface:** Реализована кнопка "АННУЛИРОВАТЬ" (Задача 19). Заказ получает статус отказа и красный фон.
- **Client Interface:** Добавлена кнопка "ОТКАЗАТЬСЯ" для клиента (Задача 19).
- **Client/Seller Interface:** Внедрена поддержка отображения `AdminName` и `AdminModel` с приоритетом над оригинальными данными.
- **Backend (GAS):** Поддержка 14-й колонки (N) "ОТКАЗ". Новые методы `refuse_order` и `update_json`.
- **Файлы:** `AdminInterface.tsx`, `ClientInterface.tsx`, `SellerInterface.tsx`, `sheetService.ts`, `types.ts`, `TG_BLOCK_V2.js`.

## 1.9.7
- **Seller Interface:** Добавлен новый статус "ОТКАЗ" (Refusal) для заказов в списке "Отправленные".
- **Logic:** Если в предложении поставщика все позиции имеют количество `0`, заказ помечается серой иконкой Ban и текстом "ОТКАЗ", вместо "На проверке" или "Проиграл".
- **Файлы:** `components/SellerInterface.tsx`.
- **Зачем:** Улучшение визуальной индикации. Поставщик сразу видит в истории, от каких заказов он отказался.

## 1.9.6
- **Seller Interface:** Удалено всплывающее подтверждение (`window.confirm`) при отправке предложения. Это устранило проблему, когда кнопка нажималась, но действие не происходило.
- **Seller Interface:** Добавлена логика умной кнопки. Если по всем позициям проставлен статус "Нет в наличии" (Qty=0), кнопка становится красной и меняет текст на "Отказаться".
- **Файлы:** `components/SellerInterface.tsx`.
- **Зачем:** Исправление бага UX (Задача 14) и улучшение семантики отказа от заказа.

## 1.9.5
- **Seller Interface:** Реализована строгая блокировка кнопки "Отправить предложение".
- **Logic:** Кнопка активна только тогда, когда по **ВСЕМ** позициям принято решение: либо указана цена > 0, либо позиция отмечена как "Нет в наличии" (Кол-во = 0).
- **UI:** Заблокированная кнопка становится серой и меняет текст на "Заполните цены".
- **Файлы:** `components/SellerInterface.tsx`.
- **Зачем:** Исключение возможности отправки пустых или неполных предложений (кроме случаев явного отказа).

## 1.9.4
- **Seller Interface:** Добавлен хедер таблицы для desktop-версии с названиями колонок.
- **Seller/Admin Interface:** Колонка автомобиля разбита на 3 отдельных: `Марка | Модель | Год`. Парсинг строки `car.model` происходит "на лету" (первое слово = бренд, остальное = модель).
- **Seller Interface:** Кнопка "Нет позиции" (Ban) перенесена влево от поля "Кол-во" для удобства.
- **Файлы:** `components/SellerInterface.tsx`, `components/AdminInterface.tsx`.
- **Зачем:** Улучшение визуального восприятия списка заказов (Задача 13) и эргономики ввода (Новая фича).

## 1.9.3
- **Seller/Admin:** Полный редизайн блока характеристик авто в раскрытом заказе. Внедрена сетка `VIN | Марка | Модель | Кузов | Год`.
- **Admin:** В блок характеристик добавлены данные о клиенте (Имя).
- **Seller:** Реализована кнопка "Нет позиции" (иконка Ban) для быстрого отказа. Она обнуляет количество и перечеркивает название детали.
- **Seller:** Добавлен визуальный тег "Укажите цену" (Orange), если цена равна 0.
- **Файлы:** `components/SellerInterface.tsx`, `components/AdminInterface.tsx`.
- **Зачем:** Выполнение задачи 13 (Детализация авто) и улучшение UX ввода цен (Задачи 10, 11 + Новая кнопка отказа).

## 1.9.2
- **Seller Interface:** Изменены тексты в дашборде на "ЗАКАЗОВ" и "ВСЕГО ЗАКАЗОВ".
- **Seller Interface:** Статус "На проверке админом" сокращен до "На проверке".
- **Seller Interface:** Обновлены тексты результата: "ВЫИГРАЛ", "ПРОИГРАЛ", "ЧАСТИЧНО".
- **Seller Interface:** Добавлен блок подробных характеристик авто (VIN, Двигатель, КПП) в раскрытую карточку заказа.
- **Seller Interface:** Введена валидация цены: сброс в 0 при превышении 1 млн, красная подсветка пустых полей.
- **Seller Interface:** Введена валидация количества: желтый тег "ДЕФИЦИТ" и Popup-подтверждение при отправке неполного количества.
- **Файлы:** `components/SellerInterface.tsx`.
- **Зачем:** Выполнение задач 7, 10, 11, 12, 13, 17, 24 Этапа 3 (Адаптация интерфейса поставщика).

## 1.9.1
- **Client Interface:** Полный редизайн строки заказа (Grid Layout). Дата и количество позиций вынесены в отдельные столбцы.
- **Client Interface:** Внедрен Optimistic UI при создании заказа. Заказ появляется в списке мгновенно.
- **Client Interface:** Вместо блокирующего лоадера на кнопке, теперь лоадер отображается в колонке ID создаваемого заказа.
- **Client Interface:** После получения реального ID от сервера строка заказа подсвечивается (вспыхивает) зеленым цветом.
- **Файлы:** `components/ClientInterface.tsx`.
- **Зачем:** Улучшение отзывчивости интерфейса (Задача 3) и читаемости списка (Задача 8).

## 1.9.0
- **Client Interface:** Реализован локальный поиск по заказам (ID, VIN, Модель, Детали) над списком заказов.
- **Client Interface:** Обновлена логика создания заказа. Теперь приложение ждет реальный ID от API перед отображением в списке. Кнопка отправки показывает состояние загрузки.
- **Client Interface:** Исправлен Toast-уведомление, теперь оно показывает реальный ID созданного заказа.
- **Client Interface:** Добавлена дата создания заказа в карточку списка.
- **Client Interface:** Изменен статус деталей в открытом заказе с "Поиск..." на "В очереди" (с иконкой часов).
- **SheetService:** Метод `createOrder` теперь возвращает `Promise<string>` (ID заказа).
- **Файлы:** `components/ClientInterface.tsx`, `services/sheetService.ts`.
- **Зачем:** Выполнение задач 3, 4, 5, 6, 8 Этапа 2 (Улучшение UX и информативности).

## 1.8.3
- **Client Interface:** Изменена логика реакции на ввод "лишних" символов в телефоне.
- **Client Interface:** Убрана красная рамка у неполного номера (он выглядит нейтрально).
- **Client Interface:** Добавлен эффект "вспышки" (красная рамка на 300мс), если пользователь пытается ввести более 11 цифр. При этом ввод блокируется.
- **Client Interface:** Кнопка "Создать аккаунт" остается заблокированной до полного ввода номера.
- **Файлы:** `components/ClientInterface.tsx`.
- **Зачем:** Корректировка UX согласно замечаниям (Задача 20) — убрать агрессивную валидацию, оставить только feedback на превышение.

## 1.8.2
- **Client Interface:** Обновлен список брендов (1:1 из требования). Добавлен полный список "Все марки".
- **Client Interface:** Изменена логика валидации телефона. Убрано жесткое ограничение ввода 11 символов. Теперь ввод не блокируется, но при превышении длины поле подсвечивается красным ("Слишком много цифр"), а кнопка "Создать аккаунт" блокируется.
- **Cleanup:** Удалены технические комментарии (`// Fix...`) для чистоты кода.
- **Файлы:** `components/ClientInterface.tsx`.
- **Зачем:** Финализация задач 20 и 9 Этапа 1 по замечаниям пользователя.

## 1.8.1
- **Client Interface:** Внедрен Combobox (поиск + выбор) для поля "Марка авто". Загружен полный список из 200+ брендов.
- **Client Interface:** Обновлена логика поля "Модель". Теперь это текстовое поле для ручного ввода, чтобы не ограничивать пользователя.
- **Client Interface:** Исправлена логика маски телефона. Теперь при переполнении номер не сбрасывается, а обрезается. Добавлена визуальная валидация (красная рамка) для неполных номеров.
- **Файлы:** `components/ClientInterface.tsx`.
- **Зачем:** Исправление замечаний по задачам 9 (Выбор марки) и 20 (Маска ввода).

## 1.8.0
- **Client Interface:** Внедрена маска ввода телефона `+7 (XXX) XXX-XX-XX` на экране авторизации.
- **Client Interface:** Полная переработка выбора автомобиля. Текстовые поля заменены на селекторы "Бренд -> Модель".
- **Client Interface:** Добавлена база данных `CAR_DB` (Популярные бренды). Добавлена возможность ручного ввода модели ("ДРУГОЕ").
- **Client Interface:** Ограничение длины названия детали (`maxLength=90`) и количества (макс. 1000).
- **App:** Добавлены контакты поддержки в хедер приложения.
- **Файлы:** `App.tsx`, `components/ClientInterface.tsx`.
- **Зачем:** Выполнение задач Этапа 1 (Валидация, UX формы заказа, Контакты) согласно плану.

## 1.7.9
- **Core:** Исправлена критическая ошибка "SyntaxError: The requested module '@/App' does not provide an export named 'default'".
- **Core:** Восстановлен полный код компонента `App.tsx` и добавлен `export default App`.
- **Файлы:** `App.tsx`.
- **Зачем:** Восстановление работоспособности приложения после сбоя сборки.

## 1.7.8
- **Docs:** Создан файл `Interface Descriptions.md` с полным описанием всех UI-элементов, полей ввода и кнопок.
- **System Prompt:** Добавлено требование ("UI РЕЕСТР") обновлять файл описания интерфейсов при любых изменениях фронтенда.
- **Файлы:** `for agents/Interface Descriptions.md`, `for agents/System prompt.md`, `for agents/version.md`.
- **Зачем:** Систематизация знаний об элементах управления для предотвращения путаницы при доработках UI/UX.

## 1.7.7
- **Client Interface:** Удалена вкладка "В ожидании".
- **Client Interface:** Все активные заказы объединены во вкладке "В обработке".
- **Client Interface:** Статус заказа теперь динамический: "В ОБРАБОТКЕ" (если нет утвержденных цен) или "ГОТОВО" (если КП утверждено).
- **Docs:** Обновлены `Interaction and Logic.md` и `Project Description.md` в соответствии с новой логикой вкладок.
- **Файлы:** `components/ClientInterface.tsx`, `for agents/Interaction and Logic.md`, `for agents/Project Description.md`.
- **Зачем:** Упрощение UX для клиента, избавление от лишних кликов и более понятная визуализация процесса оценки заказа.

## 1.7.6
- **System Prompt:** Внедрено правило "ПРАВИЛО ИСТОРИИ" (запрет удаления данных из version.md).
- **System Prompt:** Повышены требования к детализации (файлы, функции, причины).
- **Файлы:** `for agents/System prompt.md`, `for agents/version.md`.
- **Зачем:** Обеспечение прозрачности разработки и защиты от потери контекста при смене сессий или агентов.

## 1.7.5
- **Docs:** Полное восстановление файла истории. Устранена ошибка усечения данных. Все версии с 1.0.0 по 1.7.4 теперь зафиксированы в едином реестре.

## 1.7.4
- **Docs:** В `Interaction and Logic.md` добавлен раздел "Система уведомлений Telegram".
- **Docs:** Описаны триггеры и структура всех 4-х типов сообщений (Новый заказ, Оффер, КП, Покупка).
- **Docs:** Уточнена логика автоматического расчета "ИТОГО" ботом при подтверждении покупки.

## 1.7.3
- **Docs:** Документация в папке `for agents` расширена в 3 раза.
- **Docs:** Добавлен "UI Actions Dictionary" with описание логики каждой функциональной кнопки.
- **Docs:** Описана работа "Аналитического движка" (Dashboard Engine) и алгоритмы обработки дат.
- **Docs:** Детализирована интеграция с Telegram и Битрикс24 на уровне передачи данных.
- **Docs:** Описаны механизмы предотвращения конфликтов (Race Condition) в гибридной модели данных.

## 1.7.2
- **Docs:** Произведен глубокий технический анализ и переработка `Project Description.md`. Добавлена информация о "Золотом правиле JSON" (Column H).

## 1.7.1
- **Docs:** Проект переименован под авторством Дмитрия Кошнерова и Егора Жучего в `README.md`.

## 1.3.3
- **Admin UX:** Обновлен дизайн строки заказа. Удален статус [ОТКРЫТ], заменен на индикатор количества предложений [n предл.].
- **Admin Visuals:** Структура списка заказов приведена к единому стилю с интерфейсом Поставщика: ID | Model | VIN | Pos | Date | Action.

## 1.3.2
- **Admin UX:** Доработана анимация утверждения заказа. Теперь процесс состоит из двух фаз: Мгновенная реакция (Success State) и плавное Исчезновение после ответа сервера.
- **Admin UX:** Добавлен параметр max-h в CSS для анимации высоты, чтобы избежать "прыжков" при удалении элемента.

## 1.3.1
- **Admin UX:** Изменен цвет анимации подтверждения заказа с красного на зеленый (bg-emerald-50).
- **Admin UX:** Синхронизировано время удаления элемента (700мс) с длительностью CSS-анимации.

## 1.3.0
- **Admin UX:** Внедрена анимация "сгорания" (vanishing) для утвержденных заказов.
- **Client UX:** Обновлен дизайн уведомления об успешном создании заказа (черный Toast).
- **Consistency:** Единый механизм обратной связи для всех ролей (Toast + Animations).

## 1.2.6
- **Seller UX:** Реализована анимация "исчезновения" (vanishing) для отправленных заказов.
- **Visuals:** При отправке оффера строка заказа окрашивается в красный (bg-red-50), сжимается и плавно исчезает.
- **Feedback:** Добавлено всплывающее уведомление "Успешно: Предложение отправлено".

## 1.2.5
- **Bugfix:** Исправлена ошибка ReferenceError: StatCard is not defined в интерфейсе поставщика.

## 1.2.4
- **Seller Interface (Visuals):** Дизайн списка заказов унифицирован с интерфейсом Клиента.
- **Seller Interface (Logic):** Добавлен индикатор загрузки (Loader2) для статистики.

## 1.2.3
- **Seller Interface (Visuals):** Восстановлен карточный вид списка заказов с границами и тенями.
- **Seller Interface (Hover):** Добавлена визуальная реакция на наведение.

## 1.2.2
- **Logic:** Переписан парсер дат с использованием регулярных выражений для статистики.
- **UI:** Список заказов Поставщика приведен к компактному "однострочному" виду.
- **Visuals:** Раскрытая форма подачи цены очищена от темных фонов, добавлен пульсирующий индикатор.

## 1.2.1
- **Seller Interface (UI):** Возвращен компактный вид списка заказов (как у Клиента).
- **Seller Interface (UX):** Раскрытие заказа по клику на всю строку.
- **Bugfix:** Исправлен парсинг дат для статистики (поддержка разных разделителей).

## 1.2.0
- **Seller Interface:** Полный редизайн интерфейса поставщика. Внедрен дашборд и карточка "Лидер спроса".
- **Filters:** Добавлена строка поиска и динамические фильтры по маркам авто.

## 1.1.12
- **Seller Interface:** Ужесточение ввода количества (не более запрашиваемого).

## 1.1.11
- **Seller Interface:** Добавлена валидация количества в оффере с индикацией "ПРЕВЫШЕНИЕ".

## 1.1.10
- **UI:** Унификация стиля активных элементов списка (ring-indigo-600 и shadow-indigo-100).

## 1.1.9
- **General UI:** Исправлена проблема выделения раскрытого элемента (удален divide-y).
- **Style:** Раскрытый элемент теперь имеет эффект "pop-out" (z-10, shadow-xl, my-2).

## 1.1.8
- **Seller Interface:** Расширен функционал поиска по всем полям заказа.

## 1.1.7
- **General:** Внедрен компонент Pagination.tsx для всех интерфейсов.

## 1.1.5
- **Client Interface:** Добавлен блок "Запрашиваемые позиции" со статусом "Поиск...".

## 1.1.4
- **Backend (Google Sheets):** Исправлена логика генерации сводки в Колонке I.
- **Client Interface:** Добавлена черная плашка "ИТОГО К ОПЛАТЕ".

## 1.1.3
- **Admin Interface:** Добавлена возможность ручного ввода цены продажи и валюты.
- **Admin Interface:** Реализована оптимистичная UI-реакция при выборе поставщика.

## 1.1.0
- **General:** Стабилизация базового функционала SPA.
- **Telegram:** Полная интеграция уведомлений.
- **Google Sheets:** Внедрение JSON-структуры в колонку H.

## 1.0.0
- **Init:** Начальная версия проекта. Базовая верстка и настройка Vite + React.