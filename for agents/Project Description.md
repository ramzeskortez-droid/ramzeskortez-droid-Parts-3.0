# Полное архитектурное описание: AutoParts Marketplace

## 1. Концепция и Философия
Проект является гибридной low-code платформой, где **Google Sheets** выступает в роли масштабируемого бэкенда. Система автоматизирует тендерную механику закупки автозапчастей, исключая ошибки коммуникации.

## 2. Модель данных: Single Source of Truth (SSOT)
Система использует 13-колоночную структуру. 
*   **Плоские данные (A-G, I-M):** Индексированные поля для быстрой фильтрации и визуального контроля в интерфейсе Таблиц.
*   **JSON-ядро (Колонка H):** Содержит полный объект `Order` или `Offer`. 
    *   **Важно:** Логика фронтенда всегда отдает приоритет данным из JSON. Если админ вручную изменил цену в текстовой колонке, но не обновил JSON — приложение покажет старую цену. Это защищает от случайных правок в таблице.

## 3. Состояния системы (State Machine)
Объекты проходят через следующие этапы (в восприятии Клиента):
1.  **В ОБРАБОТКЕ (OPEN):** Заказ виден всем поставщикам. Клиент видит статус "В обработке" (цен нет).
2.  **ГОТОВО (PROCESSED):** Флаг `processed = 'Y'`. Админ утвердил КП. Заказ остается во вкладке "В обработке", но метка меняется на зеленую "ГОТОВО", и появляются цены.
3.  **КУПЛЕНО (READY_TO_BUY):** Флаг `readyToBuy = 'Y'`. Клиент нажал кнопку покупки. Заказ перемещается во вкладку **Архив**.
4.  **ЗАКРЫТ (CLOSED):** Финальное состояние. Запись заморожена.

## 4. Безопасность и Изоляция
*   **Client Auth:** Хранится в `localStorage.client_auth`. Изолирует заказы конкретного пользователя по имени/телефону.
*   **Seller Auth:** Хранится в `localStorage.seller_token`. Определяет, какие офферы помечаются как "Мои" в интерфейсе поставщика.
*   **Admin Access:** На данный момент является открытым интерфейсом для управления, но требует знания URL веб-приложения.

## 5. Синхронизация данных
*   **Polling:** Приложение опрашивает сервер (GAS) каждые 15-20 секунд.
*   **Optimistic UI:** При совершении действия (например, отправка оффера), элемент визуально пропадает или меняет статус мгновенно. Если сервер вернет ошибку, `fetchData(true)` откатит стейт к актуальному.
*   **Race Condition:** Блокировка `isMutationLocked` в `SheetService` предотвращает чтение данных в момент, когда запись в Sheets еще не завершена.